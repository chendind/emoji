var ImageOrientationFix=function(a){function e(a){var c=(a.naturalWidth,a.naturalHeight),d=document.createElement("canvas");d.width=1,d.height=c;var e=d.getContext("2d");e.drawImage(a,0,0);for(var f=e.getImageData(0,0,1,c).data,g=0,h=c,i=c;i>g;){var j=f[4*(i-1)+3];0===j?h=i:g=i,i=h+g>>1}var k=i/c;return 0===k?1:k}function f(a,b,c,d,f,g,h,i,j,k){var l=e(b);a.drawImage(b,c*l,d*l,f*l,g*l,h,i,j,k)}var b={image:"",imgType:"url",onFix:function(a){}},c={},d="";$.extend(b,a);var g={init:function(){var a=new Image,e=this;d=a,a.onload=function(){EXIF.getData(this,function(){c=EXIF.getAllTags(this),e.__fix()})},"image"==b.imgType?a.src=$(b.image).attr("src"):a.src=b.image},__fix:function(){var a={width:d.naturalWidth,height:d.naturalHeight,transX:0,transY:0,XDimension:0,YDimension:0,Orientation:1};a.Orientation=c.Orientation,void 0==a.Orientation&&(a.Orientation=1);var e=0,g=0;1!=a.Orientation?(a.transX=parseInt(a.width/2),a.transY=parseInt(a.height/2)):(a.transX=0,a.transY=0),e=d.width,g=d.height;var h=c.PixelXDimension,i=c.PixelYDimension;a.XDimension=h,a.YDimension=i;var j=document.createElement("canvas");j.width=a.width,j.height=a.height;var k=j.getContext("2d");k.clearRect(0,0,j.width,j.height),f(k,d,0,0,e,g,0,0,e,g);var l=document.createElement("canvas"),m=l.getContext("2d");switch(a.Orientation){case 8:e=i,g=h,l.width=e,l.height=g,m.translate(parseInt(e/2),parseInt(g/2)),m.rotate(-.5*Math.PI),m.drawImage(j,0,0,j.width,j.height,0-a.transX,0-a.transY,j.width,j.height);break;case 3:e=h,g=i,l.width=e,l.height=g,m.translate(parseInt(e/2),parseInt(g/2)),m.rotate(Math.PI),m.drawImage(j,0,0,j.width,j.height,0-a.transX,0-a.transY,j.width,j.height);break;case 6:e=i,g=h,l.width=e,l.height=g,m.translate(parseInt(e/2),parseInt(g/2)),m.rotate(.5*Math.PI),m.drawImage(j,0,0,j.width,j.height,0-a.transX,0-a.transY,j.width,j.height);break;case 1:l.width=e,l.height=g,m.drawImage(j,0,0,e,g,0-a.transX,0-a.transY,j.width,j.height)}var n=l.toDataURL();b.onFix(n)}};g.init();var h={getExif:function(){return c}};return h};